---
import Section from "./Section.astro";

const projects = [
    {
        title: "Real-time Style Transfer",
        description:
            "Ported VGG-19 to NCNN for Android, applying INT8 quantization to achieve 24fps on Snapdragon 855 (vs 5fps baseline) with <2% perceptual loss (LPIPS).",
        outcome:
            "Shipped to 50k+ active users; enabled real-time interaction on mid-range hardware.",
        proof: [
            { label: "Latency", value: "41ms @ 512px" },
            { label: "Model Size", value: "14MB (INT8)" },
            { label: "Scale", value: "50k MAU" },
        ],
        tags: ["PyTorch", "TensorRT", "C++", "NCNN"],
        github: "#",
        link: "/projects/style-transfer",
    },
    {
        title: "RL Multi-Agent Trading",
        description:
            "Orchestrated 3 competitive PPO agents sharing an observation space. Modeled 5bps transaction costs & slippage to prevent overfitting to noise.",
        outcome:
            "Achieved 2.1 Sharpe Ratio (vs 0.8 baseline) in walk-forward testing spanning 2018-2022.",
        proof: [
            { label: "Sharpe", value: "2.1 vs 0.8" },
            { label: "Latency", value: "12ms exec" },
            { label: "Method", value: "Walk-forward" },
        ],
        tags: ["Ray Rllib", "Python", "VectorBT", "Redis"],
        github: "#",
        link: "/projects/rl-trading",
    },
    {
        title: "Medical Semantic Segmentation",
        description:
            "Implemented Monte Carlo Dropout U-Net to quantify uncertainty, filtering high-confidence false positives. Validated with strict patient-level splits.",
        outcome:
            "Reduced false positives by 15% at fixed sensitivity (0.92 Dice) compared to vanilla U-Net baseline.",
        proof: [
            { label: "Dice", value: "0.92 (Test)" },
            { label: "FP/Scan", value: "1.2 vs 4.0" },
            { label: "Inference", value: "150ms/slice" },
        ],
        tags: ["TensorFlow", "Keras", "NumPy", "OpenCV"],
        github: "#",
        link: "/projects/medical-segmentation",
    },
    {
        title: "Distributed Rate Limiter",
        description:
            "Sliding window rate limiter using Redis Lua scripts for atomic precision. Designed for write-heavy loads with explicit scale failure handling.",
        outcome:
            "Protected backend from 50k QPS 'hot key' spikes with <2ms added latency. 0% false positives.",
        proof: [
            { label: "Throughput", value: "100k QPS" },
            { label: "Latency", value: "p99 < 2ms" },
            { label: "Scale", value: "Fail-open" },
        ],
        tags: ["Redis", "Lua", "Go", "System Design"],
        github: "#",
        link: "/projects/distributed-rate-limiter",
    },
];
---

<Section id="projects" class="py-24">
    <div class="max-w-6xl mx-auto px-8">
        <div
            class="flex flex-col md:flex-row md:items-end justify-between mb-16 gap-6"
        >
            <div class="space-y-4">
                <h2 class="font-display text-4xl font-bold tracking-tight">
                    Selected Projects
                </h2>
                <p class="text-text-secondary max-w-xl">
                    Focused on bridging the gap between innovative research and
                    production-grade software performance.
                </p>
            </div>
            <a
                href="https://github.com/wilsebbis"
                target="_blank"
                class="kinetic-underline text-accent-primary font-semibold flex items-center gap-2"
            >
                Archives on GitHub
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path
                        d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"
                    ></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg
                >
            </a>
        </div>

        <div class="relative -mx-8 px-8">
            <div
                id="projects-carousel"
                class="flex gap-8 overflow-x-auto pb-12 snap-x snap-mandatory no-scrollbar scroll-smooth"
                style="-webkit-overflow-scrolling: touch;"
            >
                {
                    projects.map((project) => (
                        <div class="glass-card glass-card-hover p-8 flex flex-col group h-auto min-w-[350px] md:min-w-[400px] snap-center">
                            <div class="mb-6">
                                <h3 class="font-display text-xl font-bold group-hover:text-accent-primary transition-colors mb-2">
                                    {project.title}
                                </h3>
                                <p class="text-sm text-text-secondary line-clamp-2">
                                    {project.description}
                                </p>
                            </div>

                            <div class="bg-accent-primary/5 border-l-2 border-accent-primary/30 p-4 mb-6">
                                <p class="text-xs font-mono text-accent-primary uppercase tracking-wider mb-1">
                                    Key Outcome
                                </p>
                                <p class="text-sm text-text-primary leading-snug">
                                    {project.outcome}
                                </p>
                            </div>

                            <!-- Proof Chips -->
                            <div class="flex flex-wrap gap-2 mb-8">
                                {project.proof.map((chip) => (
                                    <div class="inline-flex items-center px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] font-mono whitespace-nowrap">
                                        <span class="text-text-secondary mr-1.5">
                                            {chip.label}:
                                        </span>
                                        <span class="text-accent-primary font-semibold">
                                            {chip.value}
                                        </span>
                                    </div>
                                ))}
                            </div>

                            <div class="flex-grow" />

                            <div class="flex flex-wrap gap-2 mb-8">
                                {project.tags.map((tag) => (
                                    <span class="text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-tighter bg-white/5 border border-white/5 text-text-secondary" translate="no">
                                        {tag}
                                    </span>
                                ))}
                            </div>

                            <div class="flex items-center gap-4 border-t border-white/5 pt-6 mt-auto">
                                <a
                                    href={project.github}
                                    class="text-text-secondary hover:text-white transition-colors"
                                    aria-label="Github"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                    >
                                        <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" />
                                        <path d="M9 18c-4.51 2-5-2-7-2" />
                                    </svg>
                                </a>
                                <a
                                    href={project.link}
                                    class="kinetic-underline text-sm font-bold text-text-primary"
                                >
                                    Details
                                </a>
                            </div>
                        </div>
                    ))
                }
            </div>
            
            <!-- Navigation Controls -->
            <div class="flex justify-center gap-4 mt-8">
                <button
                    id="prev-project"
                    class="glass-card px-4 py-2 hover:bg-white/10 transition-colors pointer-events-auto cursor-pointer"
                    aria-label="Previous Projects"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
                <button
                    id="next-project"
                    class="glass-card px-4 py-2 hover:bg-white/10 transition-colors pointer-events-auto cursor-pointer"
                    aria-label="Next Projects"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                </button>
            </div>
        </div>
    </div>
</Section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const carousel = document.getElementById('projects-carousel');
        const prevBtn = document.getElementById('prev-project');
        const nextBtn = document.getElementById('next-project');

        if (carousel && prevBtn && nextBtn) {
            const updateButtonStates = () => {
                const isAtStart = carousel.scrollLeft <= 5; // tolerance
                const isAtEnd = carousel.scrollLeft + carousel.clientWidth >= carousel.scrollWidth - 5;

                if (isAtStart) {
                    prevBtn.classList.add('opacity-50', 'pointer-events-none');
                } else {
                    prevBtn.classList.remove('opacity-50', 'pointer-events-none');
                }

                if (isAtEnd) {
                    nextBtn.classList.add('opacity-50', 'pointer-events-none');
                } else {
                    nextBtn.classList.remove('opacity-50', 'pointer-events-none');
                }
            };

            // Button Logic
            prevBtn.addEventListener('click', () => {
                carousel.scrollBy({ left: -400, behavior: 'smooth' });
            });

            nextBtn.addEventListener('click', () => {
                carousel.scrollBy({ left: 400, behavior: 'smooth' });
            });

            // Listen for scroll
            carousel.addEventListener('scroll', updateButtonStates, { passive: true });
            
            // Initial check
            updateButtonStates();
            
            // Re-check on resize
            window.addEventListener('resize', updateButtonStates);
        }
    });
</script>
