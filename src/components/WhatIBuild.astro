---
import Section from "./Section.astro";

const phrasedProjects = [
    {
        project: "an LLM",
        purpose: "cooking",
        progress: "helped 10,000 people become better home chefs",
        projectColor: "text-accent-primary",
        purposeColor: "text-accent-secondary",
        progressColor: "text-accent-tertiary",
    },
    {
        project: "a data pipeline",
        purpose: "family connections",
        progress: "reconnected 5,000 families across the globe",
        projectColor: "text-accent-secondary",
        purposeColor: "text-accent-tertiary",
        progressColor: "text-accent-primary",
    },
    {
        project: "a deployment engine",
        purpose: "edge devices",
        progress: "shipped 50+ models to production",
        projectColor: "text-accent-tertiary",
        purposeColor: "text-accent-primary",
        progressColor: "text-accent-secondary",
    },
    {
        project: "a training platform",
        purpose: "model iteration",
        progress: "reduced training time by 10x",
        projectColor: "text-accent-primary",
        purposeColor: "text-accent-tertiary",
        progressColor: "text-accent-secondary",
    },
];
---

<Section
    id="what-i-build"
    class="py-32 md:py-48 min-h-[90vh] flex flex-col items-center justify-center overflow-hidden"
>
    <div class="max-w-6xl mx-auto px-8 w-full">
        <!-- Dynamic Headline -->
        <div class="text-center mb-24">
            <h2
                class="font-display text-3xl md:text-5xl font-bold tracking-tight leading-[1.3] mb-4"
            >
                <span id="static-prefix">I built</span>
                <span
                    id="dynamic-project"
                    class="dynamic-word text-accent-secondary"></span>
                <span id="static-for">for</span>
                <span
                    id="dynamic-purpose"
                    class="dynamic-word text-accent-tertiary"></span>
                <span id="static-that">that</span>
                <span
                    id="dynamic-progress"
                    class="dynamic-word text-accent-primary"></span>
            </h2>
        </div>

        <!-- Capability Cards -->
    </div>
</Section>

<style>
    .dynamic-word {
        display: inline;
        margin: 0 0.2em;
        opacity: 1;
        transform: translateY(0);
        -webkit-transition:
            opacity 0.35s ease,
            transform 0.35s ease;
        transition:
            opacity 0.35s ease,
            transform 0.35s ease;
    }
    .dynamic-word.hidden {
        opacity: 0;
        transform: translateY(-0.5rem);
    }
</style>

<script>
    const phrases = [
        {
            project: "a data pipeline",
            purpose: "family connections",
            progress: "reconnected 5,000 families across the globe",
            projectClass: "text-accent-secondary",
            purposeClass: "text-accent-tertiary",
            progressClass: "text-accent-primary",
        },
        {
            project: "an LLM",
            purpose: "cooking",
            progress: "helped 10,000 people become better home chefs",
            projectClass: "text-accent-primary",
            purposeClass: "text-accent-secondary",
            progressClass: "text-accent-tertiary",
        },
        {
            project: "a deployment engine",
            purpose: "edge devices",
            progress: "shipped 50+ models to production",
            projectClass: "text-accent-tertiary",
            purposeClass: "text-accent-primary",
            progressClass: "text-accent-secondary",
        },
        {
            project: "a training platform",
            purpose: "model iteration",
            progress: "reduced training time by 10x",
            projectClass: "text-accent-primary",
            purposeClass: "text-accent-tertiary",
            progressClass: "text-accent-secondary",
        },
    ];

    let currentIndex = 0;
    const projectEl = document.getElementById("dynamic-project");
    const purposeEl = document.getElementById("dynamic-purpose");
    const progressEl = document.getElementById("dynamic-progress");

    function updatePhrasing() {
        if (!projectEl || !purposeEl || !progressEl) return;

        const {
            project,
            purpose,
            progress,
            projectClass,
            purposeClass,
            progressClass,
        } = phrases[currentIndex];

        // Phase 1: Fade UP and OUT
        projectEl.classList.add("hidden");
        purposeEl.classList.add("hidden");
        progressEl.classList.add("hidden");

        // Phase 2: After fade-out, update content and fade IN
        setTimeout(() => {
            // Update content
            projectEl.textContent = project;
            purposeEl.textContent = purpose;
            progressEl.textContent = progress;

            // Update color classes
            projectEl.className = "dynamic-word hidden " + projectClass;
            purposeEl.className = "dynamic-word hidden " + purposeClass;
            progressEl.className = "dynamic-word hidden " + progressClass;

            // Small delay to let browser register the hidden state
            setTimeout(() => {
                // Remove hidden to trigger fade-in
                projectEl.classList.remove("hidden");
                purposeEl.classList.remove("hidden");
                progressEl.classList.remove("hidden");
            }, 50);

            currentIndex = (currentIndex + 1) % phrases.length;
        }, 350);
    }

    // Initial run (show first phrase immediately)
    if (projectEl && purposeEl && progressEl) {
        const first = phrases[0];
        projectEl.textContent = first.project;
        purposeEl.textContent = first.purpose;
        progressEl.textContent = first.progress;
        projectEl.className = "dynamic-word " + first.projectClass;
        purposeEl.className = "dynamic-word " + first.purposeClass;
        progressEl.className = "dynamic-word " + first.progressClass;
        currentIndex = 1;
    }

    // Interval
    if (!window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
        setInterval(updatePhrasing, 4000);
    }
</script>
